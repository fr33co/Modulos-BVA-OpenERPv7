<?xml version="1.0" encoding="UTF-8"?>

<openerp>
    <data>

<!--
SECUENCIA
-->

        <record id="seq_type_proyectos" model="ir.sequence.type">
            <field name="name">Proyectos</field>
            <field name="code">gdc.proyectos</field>
        </record>
        <record id="seq_proyectos" model="ir.sequence">
            <field name="name">Repair Order</field>
            <field name="code">gdc.proyectos</field>
            <field name="prefix">GDC</field>
            <field name="padding">6</field>
        </record>

<!--
FONDO DE FINANCIAMIENTO
-->

        <record model="ir.actions.act_window" id="financiamiento_list_action">
            <field name="name">Fondos de financiamiento</field>
            <field name="res_model">gdc.fondos</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Crear fondos de financiemientos.
              </p>
            </field>
        </record>

        <record model="ir.ui.view" id="fondos_tree_view">
            <field name="name">gdc.proyectos.tree</field>
            <field name="model">gdc.fondos</field>
            <field name="arch" type="xml">
                <tree string="Fondos de financiamiento">
                    <field name="name"/>
                </tree>
            </field>
        </record>
       
        <record model="ir.ui.view" id="fondos_form_view">
            <field name="name">gdc.proyectos.form</field>
            <field name="model">gdc.fondos</field>
            <field name="arch" type="xml">
                <form string="Fondos de financiamiento">
                    <field name="name" />
                </form>
            </field>
        </record>

<!--
PROYECTOS
-->

        <record model="ir.actions.act_window" id="proyectos_list_action">
            <field name="name">Proyectos</field>
            <field name="res_model">gdc.proyectos</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,gantt</field>
            <field name="domain">['|', ('responsible_id','=',uid), ('supervisor_id','=',uid)]</field>
            <field name="help" type="html">
            </field>
        </record>
        
        <record model="ir.ui.view" id="proyectos_tree_view">
            <field name="name">gdc.proyectos.tree</field>
            <field name="model">gdc.proyectos</field>
            <field name="arch" type="xml">
                <tree string="Proyectos" colors="red:estado in ('Propuesto', 'Vencido');blue:estado in ('Planificacion', 'Progreso');green:estado=='Terminado';gray:estado in ('Archivado', 'Plantilla');orange:estado=='Congelado'">
                    <field name="date_created" />
                    <field name="codigo" />
                    <field name="actividad" />
                    <field name="supervisor_id"/>
                    <field name="responsible_id"/>
                    <field name="cobertura" />
                    <field name="tipo_financiamiento"/>
                    <field name="address_id" />
                    <field name="priority"/>
                    <field name="date_start"/>
                    <field name="date_end"/>
                    <field name="estado"/>
                    <field name="progreso" widget="progressbar"/>
                    <field name="dias_proyecto"/>
                </tree>
            </field>
        </record>
        
        <record model="ir.ui.view" id="proyectos_view_form">
            <field name="name">gdc.proyectos.form</field>
            <field name="model">gdc.proyectos</field>
            <field name="type">form</field>
            <field name="priority" eval="16"/>
            <field name="arch" type="xml">
                <form string="Asignacion" version="7.0">
                    <header attrs="{'invisible':[('estado', '=', 'Borrador')]}">
                        <button name="congelar_proyecto" string="Congelar el proyecto" type="object" class="oe_highlight" attrs="{'invisible':[('estado', '=', 'Congelado')]}"/>
                        <button name="retomar_proyecto" string="Retomar el proyecto" type="object" attrs="{'invisible':[('estado', '=', 'Progreso')]}"/>
                    </header>
                    <group>
                        <group>
                            <field name="codigo" readonly="1"/>
                            <field name="date_created" readonly="1"/>
                            <field name="dias_proyecto" readonly="1"/>
                            <field name="estado" attrs="{'readonly':[('estado', '!=', 'Borrador')]}"/>
                            <field name="progreso" readonly="1" widget="progressbar"/>
                        </group>
                        <group>
                            <field name="actividad" string="Actividad"/>
                             <field name="cobertura"/>
                             <field name="priority"/>
                             <field name="tipo_financiamiento"/>
                             <field name="adjunto_gaceta"/>  
                        </group>
                    </group>
                    <notebook>
                        <page string="Sección I">
                        <group>
                             <group>
                                <separator string="Asignación de fechas" colspan="2"/>
                                <field name="date_start" on_change="onchange_date_start(date_start)"/>
                                <field name="date_end" on_change="onchange_date_end(date_end)"/>
                                <separator string="Presupuestos" colspan="2"/>
                                <field name="presu_tentativo"/>
                                <field name="presu_real"/>
                            </group>
                            <group>
                                <separator string="Asignación de responsables" colspan="2"/>
                                <field name="supervisor_id" domain="[('category_id.name','ilike','Supervisor')]"/>
                                <field name="responsible_id" domain="[('category_id.name','ilike','Responsable')]"/>
                                <separator string="Beneficiados del proyecto" colspan="2"/>
                                <field name="bene_tentativo" colspan="2"/>
                            </group>
                        </group>
                        </page>
                        <page string="Sección II">
                            <separator string="Descripción del proyecto" colspan="2"/>
                            <field name="description" placeholder="Agregar descripcion..."/>
                        </page>
                        <page string="Sección III">
                            <group>
                                <group>
                                    <separator string="Lugar de ejecución del proyecto" colspan="2"/>
                                        <div>
                                           <field name="address_id" on_change="on_change_address_id(address_id)" domain="[('category_id.name','ilike','Lugar')]"/>
                                           <field name="street" placeholder="Direccion..."/>
                                           <field name="street2" placeholder="Cont. Direccion..."/>
                                           <div class="address_format">
                                               <field name="city" placeholder="Ciudad" style="width: 40%%"/>
                                               <field name="state_id" class="oe_no_button" placeholder="Estado" style="width: 37%%" options='{"no_open": true}'/>
                                               <field name="zip" placeholder="Codigo Postal" style="width: 20%%"/>
                                           </div>    
                                           <field name="country_id" placeholder="Pais" class="oe_no_button" options='{"no_open": true}'/>
                                       </div>
                                </group>
                                <group>
                                    <separator string="Equipo de trabajo involucrado" colspan="2"/>
                                    <field colspan="4" name="members_project" widget="many2many_kanban">
                                        <kanban quick_create="false" create="true" delete="true">
                                            <field name="name"/>
                                            <templates>
                                                <t t-name="kanban-box">
                                                    <div style="position: relative">
                                                        <a t-if="! read_only_mode" type="delete" style="position: absolute; right: 0; padding: 4px; diplay: inline-block">X</a>
                                                        <div class="oe_module_vignette">
                                                            <div class="oe_module_desc">
                                                                <field name="name"/>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </t>
                                            </templates>
                                        </kanban>
                                    </field>
                                </group>
                            </group>
                        </page>
                        <page string="Visualizador de tareas" attrs="{'invisible':[('estado', '=', 'Borrador')]}">
                            <field name="tareas_ids" nolabel="1" colspan="4" mode="tree">
                                <tree string="Tareas">
                                    <field name="name_tarea" />
                                    <field name="date_start_tarea"/>
                                    <field name="date_end_tarea"/>
                                    <field name="progreso_tarea"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Visualizador de incidencias" attrs="{'invisible':[('estado', '=', 'Borrador')]}">
                            <field name="incidencias_ids" nolabel="1" colspan="4" mode="tree">
                                <tree string="Incidencias">
                                    <field name="date_reporter"/>
                                    <field name="tarea_id"/>
                                    <field name="name_incidencia" />
                                    <field name="description"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Conclusiones" attrs="{'invisible':[('estado', '!=', 'Terminado')]}">
                            <separator string="Defina las conclusiones" colspan="2"/>
                            <field name="conclusiones" />
                        </page>
                        <page string="Acuerdos" attrs="{'invisible':[('estado', '!=', 'Terminado')]}">
                            <separator string="Defina los acuerdos llegados" colspan="2"/>
                            <field name="acuerdos"/>
                        </page>
                    </notebook>
                </form>
            </field>
        </record>

        <record id="view_proyectos_gantt" model="ir.ui.view">
            <field name="name">gdc.proyectos.gantt</field>
            <field name="model">gdc.proyectos</field>
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
                <gantt date_start="date_start" date_stop="date_end" string="Tasks">
                </gantt>
            </field>
        </record>

        <record id="view_proyectos_calendar" model="ir.ui.view">
            <field name="name">gdc.proyectos.calendar</field>
            <field name="model">gdc.proyectos</field>
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
                <calendar color="actividad" date_start="date_start" date_stop="date_end" string="Actividades">
                    <field name="actividad"/>
                </calendar>
            </field>
        </record>

<!--
TAREAS
-->

        <record model="ir.actions.act_window" id="tareas_list_action">
            <field name="name">Tareas</field>
            <field name="res_model">gdc.tareas</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,gantt</field>
            <field name="domain">['|', ('responsible_id','=',uid), ('supervisor_id','=',uid)]</field>
            <field name="help" type="html">
            </field>
        </record>

        <record model="ir.ui.view" id="tareas_tree_view">
            <field name="name">gdc.tareas.tree</field>
            <field name="model">gdc.tareas</field>
            <field name="arch" type="xml">
                <tree string="Tareas">
                    <field name="project_id2" />
                    <field name="name_tarea" />
                    <field name="responsible_id" />
                    <field name="supervisor_id" />
                    <field name="date_start_tarea"/>
                    <field name="date_end_tarea"/>
                    <field name="dias_tarea" />
                    <field name="progreso_tarea" widget="progressbar"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="tareas_form_view">
            <field name="name">gdc.tareas.form</field>
            <field name="model">gdc.tareas</field>
            <field name="arch" type="xml">
                <form string="Tareas" version="7.0">
                    <header attrs="{'invisible':[('estado_tarea', '=', 'Borrador')]}">
                        <button name="begin_tarea" string="Comenzar la tarea" type="object" class="oe_highlight" attrs="{'invisible':[('estado_tarea', '=', 'Progreso')]}"/>
                        <button name="begin_tarea" string="Finalizar la tarea" type="object"/>
                    </header>
                    <group>
                        <group>
                            <field name="project_id2" on_change="onchange_proyecto(project_id2)"/>
                            <field name="responsible_id" invisible="1"/>
                            <field name="supervisor_id" invisible="1"/>
                            <field name="name_tarea" />
                            <field name="date_start_tarea" on_change="onchange_date_start_tarea(date_start_tarea)"/>
                            <field name="date_end_tarea" on_change="onchange_date_end_tarea(date_end_tarea)"/>
                        </group>
                        <group>
                            <field name="estado_tarea" />
                            <field name="dias_tarea" />
                            <field name="progreso_tarea" readonly="1" widget="progressbar"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Descripcion de la tarea">
                            <field name="description" placeholder="Agregar descripcion..."/>
                        </page>
                        <page string="Entes ejecutantes asignados" name="team">
                            <group>
                                <field colspan="4" name="members_tareas" widget="many2many_kanban">
                                    <kanban quick_create="false" create="true" delete="true">
                                        <field name="name"/>
                                        <templates>
                                            <t t-name="kanban-box">
                                                <div style="position: relative">
                                                    <a t-if="! read_only_mode" type="delete" style="position: absolute; right: 0; padding: 4px; diplay: inline-block">X</a>
                                                    <div class="oe_module_vignette">
                                                        <div class="oe_module_desc">
                                                            <field name="name"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </t>
                                        </templates>
                                    </kanban>
                                </field>
                            </group>
                        </page>
                        <page string="Subida de informe">
                            <field name="informe_tareas"/>
                        </page>
                        <page string="Subida de imagenes">
                            <field name="image" widget='image'/>
                        </page>
                    </notebook>
                </form>
            </field>
        </record>

        <record id="view_tareas_gantt" model="ir.ui.view">
            <field name="name">gdc.tareas.gantt</field>
            <field name="model">gdc.tareas</field>
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
                <gantt date_start="date_start_tarea" date_stop="date_end_tarea" string="Tareas">
                </gantt>
            </field>
        </record>

        <record id="view_tareas_calendar" model="ir.ui.view">
            <field name="name">gdc.tareas.calendar</field>
            <field name="model">gdc.tareas</field>
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
                <calendar color="name_tarea" date_start="date_start_tarea" date_stop="date_end_tarea" string="Tareas">
                    <field name="name_tarea"/>
                </calendar>
            </field>
        </record>

<!--
INCIDENCIAS
-->

        <record model="ir.actions.act_window" id="incidencias_list_action">
            <field name="name">Incidencias</field>
            <field name="res_model">gdc.incidencias</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar</field>
            <field name="help" type="html">
            </field>
        </record>

        <record model="ir.ui.view" id="incidencias_tree_view">
            <field name="name">gdc.incidencias.tree</field>
            <field name="model">gdc.incidencias</field>
            <field name="arch" type="xml">
                <tree string="Incidencias">
                    <field name="tarea_id" />
                    <field name="name_incidencia" />
                    <field name="date_reporter" />
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="incidencias_form_view">
            <field name="name">gdc.incidencias.form</field>
            <field name="model">gdc.incidencias</field>
            <field name="arch" type="xml">
                <form string="Incidencias" version="7.0">
                    <group>
                        <group>
                            <field name="project_id" invisible="1"/>
                            <field name="date_reporter" />
                            <field name="tarea_id" on_change="onchange_tarea(tarea_id)"/>
                            <field name="name_incidencia" />
                        </group>
                        <separator string="Especifique las caracteristicas de la incidencia" colspan="2"/>
                        <field name="description" nolabel="1"/>
                    </group>
                </form>
            </field>
        </record>


        <menuitem id="main_gobiernodecalle_menu" name="Gobierno de calle y Direccionalidad" sequence="120"/>

        <menuitem id="proyectos_menu" name="Actividades" parent="main_gobiernodecalle_menu" sequence="10"/>
        <menuitem id="asigancion_menu" name="Asignacion" parent="proyectos_menu" action="proyectos_list_action" sequence="1"/>
        <menuitem id="tareas_menu" name="Tareas" parent="proyectos_menu" action="tareas_list_action" sequence="3"/>
        <menuitem id="incidencias_menu" name="Incidencias" parent="proyectos_menu" action="incidencias_list_action" sequence="4"/>
        
        <menuitem id="configuration_menu" name="Configuration" parent="main_gobiernodecalle_menu" sequence="10"/>
        <menuitem id="fondos_menu" name="Fondos de financiamiento" parent="configuration_menu" action="financiamiento_list_action"/>
    </data>
</openerp>
